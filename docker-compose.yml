version: '3.8'

services:
  planet:
    build:
      context: ./server
      dockerfile: Dockerfile
    container_name: orbit-planet
    image: orbit-planet:latest
    # ports:
    #   - "6901:6901" # REMOVED: Direct Access blocked. Use Gateway.
    volumes:
      - orbit_data:/home/orbituser
    environment:
      - VNC_PASSWORD=${VNC_PASSWORD}
      - MCP_SECRET=${MCP_SECRET}
    restart: unless-stopped
    networks:
      - orbit_net

  gateway:
    image: nginx:alpine
    container_name: orbit-gateway
    ports:
      - "443:443" # Only Secure HTTPS/WSS allowed
    volumes:
      - ./cloud/gateway/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./cloud/gateway/certs:/etc/nginx/certs:ro
    depends_on:
      - planet
    networks:
      - orbit_net
  # tunnel:
  #   # REMOVED: Insecure Cloudflare Tunnel (Phase 3: Zero Trust)
  #   # image: cloudflare/cloudflared:latest
  #   # ...

networks:
  orbit_net:
    driver: bridge

volumes:
  orbit_data:
